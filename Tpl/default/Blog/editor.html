<script src="{&STATIC}/Js/kind-editor/kindeditor-min-new.js"></script>
<script src="{&STATIC}/Js/kind-editor/zh_CN.js"></script>
<script>
	var editor;
	KindEditor.ready(function(K) {
		editor = K.create('textarea[name="forum_msg"]', {
			resizeType : 1,
			allowPreviewEmoticons : false,
			allowImageUpload : true,
			items : [ 'fontsize', '|', 'forecolor', 'hilitecolor', 'bold', 'italic', 'underline',
						'removeformat', '|', 'emoticons', 'image', 'link'],
			uploadJson:'{&WWW}/Blog/forumImgUpload',
			afterBlur:function(){this.sync();},//同步KindEditor的值到textarea文本框
			afterCreate:function(){
				var self=this;
				KindEditor.ctrl(self.edit.doc, 13, function() {
				self.sync();
				$('#forum_form').submit();
				}); 
			}
		});
		editor.focus();
	});
</script>

	<div class="ojia_luntan2">
		<div class="ojia_luntan2_top">
			<a href="#" class="ojia_luntan2_top_a1 ojia_luntan2_top_a  fn-left">发表帖子</a>
			<!--
			<a href="#" class="ojia_luntan2_top_a2 fn-left">发起投票</a>
			-->
			<div class="fn-clear"></div>
		</div>
		<form action="{&WWW}/Blog/save" method="post" onsubmit="return editorCheck();" id="forum_form">
		<div class="ojia_luntan2_entry">
			<input type="text" name="title" value="" id="ojia_valuecont"  /> 还可输入<span id="ojia_datacont"> 80 </span> 个字符
		</div>
		<div class="ojia_luntan2_entry1">
			<textarea id="bbcode_text" name="forum_msg" style="width:800px;height:432px;"></textarea>
		</div>
		<!--  
		<a href="#" class="ojia_luntan2_entry1_a1 fn-left">回帖奖励</a>
		<a href="#" class="ojia_luntan2_entry1_a2 fn-left">抢楼</a>
		<a href="#" class="ojia_luntan2_entry1_a3 fn-left">设置主题标题</a>
		-->
		<div class="fn-clear"></div>
		<div class="ojia_luntan2_entry2">
			<input type="hidden" name="type" value="{$post_type}" />
			<input type="hidden" name="fid" value="{$fid}" />
			<input type="submit" name="" value="发表帖子" class="ojia_luntan2_entry2_a1 fn-left" />
			<span style="color:#999999;">ctrl+Enter快速发帖</span>
			<!-- 
			<a href="#" class="ojia_luntan2_entry2_a2 fn-left">保存草稿</a>
			<a href="#" class="ojia_luntan2_entry2_a3 fn-right">本版积分规则</a>
			-->
		</div>
		</form>
	</div>
<script>
/*
	function ojia_value_cont(){
		var i=0;
		var ojia_i=$("#ojia_valuecont").val().length;
		var ojia_idown=80-ojia_i;
		if(ojia_i<=80){
			$("#ojia_datacont").html(ojia_idown);
		}else if(ojia_i>80) {
			$("#ojia_datacont").html(0);
		}
	}
*/
	$("#ojia_valuecont").bind('keyup change',function(){
		var i=0;
		var ojia_i=$("#ojia_valuecont").val().length;
		var ojia_idown=80-ojia_i;
		if(ojia_i<=80){
			$("#ojia_datacont").html(ojia_idown);
		}else if(ojia_i>80) {
			$("#ojia_datacont").html(0);
		}
	});
	//ojia_value_cont();
</script>
<script type="text/javascript">
  /* $(document).ready(function(){
	$("#bbcode_editor").bbcode({tag_bold:true,tag_italic:true,tag_underline:true,tag_link:true,tag_image:true,button_image:true});
  }); */

  function editorCheck(){
		var comment=$("textarea[name=forum_msg]").val();
		var n=(comment.split('<img')).length-1;
		if(n>10){
			$('.error').show();
			return false;
		}
		if(""==$.trim(comment)){
			alert("不能发表空信息！");
			return false;
		}
		return true;
	}
  
/* function ajaxFileUpload()
{
	$.ajaxFileUpload
	(
		{
			url:'{&WWW}/Attach/ajax_upload',
			secureuri:false,
			fileElementId:'attachFileUpload',
			dataType: 'json',
			beforeSend:function()
			{
				$("#loading").show();
			},
			complete:function()
			{
				$("#loading").hide();
			},				
			success: function (data, status)
			{
				if(data.status==1){
					var imgUrl="<a href='javascript:void(0);'onclick='editor_attach();' aid='"+data.data.aid+"_"+data.data.type+"' url='"+data.data.url+"'>"+data.data.name+"</a>";
					$("#upload_attach").html(imgUrl);
				}else{
					alert(data.info);
				}
			},
			error: function (data, status, e)
			{
				//alert(e);
				alert("上传文件出错！");
			}
		}
	)
	
	return false;

} */
</script>